<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        WDEG - Bypassing ASR ::
        Confidential Team — UnKn0wn
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="السلام عليكم ورحمة الله وبركاته  معظمنا واجه او سمع عن ال Windows Defender Exploit Guard وعناصره. في هذي المقالة راح يتم شرح عن المفهوم الرئيسي وشرح احد العناصر مع احد التخطيات لها.
 What is Windows Defender Exploit Guard? هو عبارة عن software كجزء من Windows Defender Security Center والذي بدوره يقوم بحماية انظمة تشغيل ويندوز من ال malware ومن عدة هجمات على المستخدم
 ايضا تم تصميم WDEG وعناصره الاربع لأغلاق الجهاز ضد اي تهديد او هجوم شائع عن طريق حظره في مراحل مختلفة من الـ Kill chain  WDEG Components: Attack Surface Reduction (ASR) - يستفيد من برنامج مكافحة الفيروسات Windows Defender (WDAV) لتعطيل الهجمات التي يتم استخدامها بشكل شائع حماية الشبكة - يحظر التهديدات التي تؤدي إلى إنشاء اتصال خارجي او IPS غير موثوق بها."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/wdeg-bypassingasrar/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WDEG - Bypassing ASR"/>
<meta name="twitter:description" content="السلام عليكم ورحمة الله وبركاته  معظمنا واجه او سمع عن ال Windows Defender Exploit Guard وعناصره. في هذي المقالة راح يتم شرح عن المفهوم الرئيسي وشرح احد العناصر مع احد التخطيات لها.
 What is Windows Defender Exploit Guard? هو عبارة عن software كجزء من Windows Defender Security Center والذي بدوره يقوم بحماية انظمة تشغيل ويندوز من ال malware ومن عدة هجمات على المستخدم
 ايضا تم تصميم WDEG وعناصره الاربع لأغلاق الجهاز ضد اي تهديد او هجوم شائع عن طريق حظره في مراحل مختلفة من الـ Kill chain  WDEG Components: Attack Surface Reduction (ASR) - يستفيد من برنامج مكافحة الفيروسات Windows Defender (WDAV) لتعطيل الهجمات التي يتم استخدامها بشكل شائع حماية الشبكة - يحظر التهديدات التي تؤدي إلى إنشاء اتصال خارجي او IPS غير موثوق بها."/>



<meta property="og:title" content="WDEG - Bypassing ASR" />
<meta property="og:description" content="السلام عليكم ورحمة الله وبركاته  معظمنا واجه او سمع عن ال Windows Defender Exploit Guard وعناصره. في هذي المقالة راح يتم شرح عن المفهوم الرئيسي وشرح احد العناصر مع احد التخطيات لها.
 What is Windows Defender Exploit Guard? هو عبارة عن software كجزء من Windows Defender Security Center والذي بدوره يقوم بحماية انظمة تشغيل ويندوز من ال malware ومن عدة هجمات على المستخدم
 ايضا تم تصميم WDEG وعناصره الاربع لأغلاق الجهاز ضد اي تهديد او هجوم شائع عن طريق حظره في مراحل مختلفة من الـ Kill chain  WDEG Components: Attack Surface Reduction (ASR) - يستفيد من برنامج مكافحة الفيروسات Windows Defender (WDAV) لتعطيل الهجمات التي يتم استخدامها بشكل شائع حماية الشبكة - يحظر التهديدات التي تؤدي إلى إنشاء اتصال خارجي او IPS غير موثوق بها." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/wdeg-bypassingasrar/" />
<meta property="article:published_time" content="2022-02-09T21:37:30-05:00" />
<meta property="article:modified_time" content="2022-02-09T21:37:30-05:00" /><meta property="og:site_name" content="Confidential Team" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Confidential Team</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">WDEG - Bypassing ASR</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2022-02-09
        </span>

        
          
        
      

      


      
        <span class="post-read-time"
          >— 3 min read</span
        >
      
    </div>

    

    

    <div class="post-content">
      
      <DIV dir="rtl" align="right">
السلام عليكم ورحمة الله وبركاته
</DIV>
<DIV dir="rtl" align="right">
معظمنا واجه او سمع عن ال Windows Defender Exploit Guard وعناصره.
<p>في هذي المقالة راح يتم شرح عن المفهوم الرئيسي وشرح احد العناصر مع احد التخطيات لها.</p>
</DIV>
<h2 id="what-is-windows-defender-exploit-guard">What is Windows Defender Exploit Guard?</h2>
<DIV dir="rtl" align="right">
<p>هو عبارة عن software كجزء من Windows Defender Security Center والذي بدوره يقوم بحماية انظمة تشغيل ويندوز من ال malware ومن عدة هجمات على المستخدم</p>
</DIV>
<DIV dir="rtl" align="right">
ايضا تم تصميم WDEG وعناصره الاربع لأغلاق الجهاز ضد اي تهديد او هجوم شائع عن طريق حظره في مراحل مختلفة من الـ Kill chain
</DIV>
<h2 id="wdeg-components">WDEG Components:</h2>
<DIV dir="rtl" align="right">
Attack Surface Reduction (ASR) - يستفيد من برنامج مكافحة الفيروسات Windows Defender (WDAV) لتعطيل الهجمات التي يتم استخدامها بشكل شائع
<p>حماية الشبكة - يحظر التهديدات التي تؤدي إلى إنشاء اتصال خارجي او IPS غير موثوق بها.</p>
<p>التحكم في وصول إلى مجلد ما - يمنع العمليات غير الموثوق بها من الوصول إلى المجلدات المرقابة / المحمية.</p>
<p>الحماية من الاستغلال - لتطبيق إعدادات التخفيف على مستوى النظام مثل DEP و ASLR و CFG وما إلى ذلك.</p>
<br>
<p>تم تركيزنا على احد عناصر الـ WDEG وهو Attack Surface Reduction.</p>
<p>كما ذكرنا سابقا ً، ان الـ ASR يُعطل الهجمات المستخدمة بشكل شائع:</p>
</DIV>
<p><img src="../../img/WDEG/1.png" alt=""></p>
<DIV dir="rtl" align="right">
يستخدم الـ ASR قواعد تم تعيننها باستخدام GUDIs ويمكن فرضها باستخدام
PowerShell Windows Defender Package , Local Group Policy
<p>وهذه أمثلة على قواعد الـ ASR:</p>
</DIV>
<ul>
<li>Block executable content from email client and webmail</li>
<li>Block all Office applications from creating child processes</li>
<li>Block Office applications from creating executable content</li>
<li>Block Office applications from injecting code into other processes</li>
<li>Block JavaScript or VBScript from launching downloaded executable content</li>
<li>Block execution of potentially obfuscated scripts</li>
<li>Block Win32 API calls from Office macro</li>
<li>Block executable files from running unless they meet a prevalence, age, or trusted list criterion</li>
<li>Use advanced protection against ransomware</li>
<li>Block credential stealing from the Windows local security authority subsystem (lsass.exe)</li>
<li>Block process creations originating from PSExec and WMI commands</li>
<li>Block untrusted and unsigned processes that run from USB</li>
<li>Block Office communication application from creating child processes</li>
<li>Block Adobe Reader from creating child processes</li>
</ul>
<DIV dir="rtl" align="right">
كما ذكرنا بان القواعد يتم تعيننها باستخدام GUDIs نبحث الان عن كل قاعدة واسمها عن طريق ال Registry
</DIV>
<pre><code>[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\WindowsDefender\Windows Defender Exploit Guard\ASR\Rules]
</code></pre><DIV dir="rtl" align="right">
هنا كل قاعدة و GUDIs الخاص بها:
</DIV>
<pre><code>&quot;56a863a9-875e-4185-98a7-b882c64b5ce5&quot;=&quot;Block abuse of exploited vulnerable signed drivers&quot;

&quot;7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c&quot;=&quot;Block Adobe Reader from creating child processes&quot;

&quot;D4F940AB-401B-4EFC-AADC-AD5F3C50688A&quot;=&quot;Block all Office applications from creating child processes&quot;

&quot;9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2&quot;=&quot;Block credential stealing from the Windows local security authority subsystem (lsass.exe)&quot;

&quot;BE9BA2D9-53EA-4CDC-84E5-9B1EEEE46550&quot;=&quot;Block executable content from email client and webmail&quot;

&quot;01443614-cd74-433a-b99e-2ecdc07bfc25&quot;=&quot;Block executable files from running unless they meet a prevalence, age, or trusted list criterion&quot;

&quot;5BEB7EFE-FD9A-4556-801D-275E5FFC04CC&quot;=&quot;Block execution of potentially obfuscated scripts&quot;

&quot;3B576869-A4EC-4529-8536-B80A7769E899&quot;=&quot;Block Office applications from creating executable content&quot;

&quot;75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84&quot;=&quot;Block Office applications from injecting code into other processes&quot;

&quot;26190899-1602-49e8-8b27-eb1d0a1ce869&quot;=&quot;Block Office communication application from creating child processes&quot;

&quot;d1e49aac-8f56-4280-b9ba-993a6d77406c&quot;=&quot;Block process creations originating from PSExec and WMI commands&quot;

&quot;b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4&quot;=&quot;Block untrusted and unsigned processes that run from USB&quot;

&quot;92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B&quot;=&quot;Block Win32 API calls from Office macros&quot;

&quot;D3E037E1-3EB8-44C8-A917-57927947596D&quot;=&quot;Block JavaScript or VBScript from launching downloaded executable content&quot;

&quot;e6db77e5-3df2-4cf1-b95a-636979351e5b&quot;=&quot;Block persistence through WMI event subscription&quot;

&quot;c1db55ab-c21a-4637-bb3f-a12568109d35&quot;=&quot;Use advanced protection against ransomware&quot;
</code></pre><DIV dir="rtl" align="right">
لناخذ هذه القاعدة Block JavaScript or VBScript from launching downloaded executable content
</DIV>
<h2 id="what-is-the-meaning-of-this-rule">What is the meaning of this rule?</h2>
<DIV dir="rtl" align="right">
<p>التعريف الحرفي هو حظر JavaScript or VBScript من تشغيل المحتوى القابل للتنفيذ الذي تم تنزيله, بمعنى انه بالأمكان استخدام نصوص JavaScript or VBScript بواسطة أحد الـ malware لتشغيل malicious apps.</p>
<p>مع العلم بأن الـ ASR لن يحظر أو يراجع اي طرق تنفيذ اعتياديه بنفسه لكن عند قيام السكربت بتنفيذ request VBScript/Jscript يقوم الـ ASR بوظيفته.</p>
<p>بأمكانك تكوين وأعداد قاعدة ASR لحظر اي تهديد من خلال الـ GUIDs وتحديد الاجراء المراد عن طريق هذا الامر:</p>
</DIV>
<pre><code>Add-MpPreference -AttackSurfaceReductionRules_Ids D3E037E1-3EB8-44C8-A917-57927947596D -AttackSurfaceReductionRules_Actions Enabled
</code></pre><DIV dir="rtl" align="right">
او عن طريق اي اداة تقوم بذلك.
</DIV>
<h2 id="demo">Demo</h2>
<DIV dir="rtl" align="right">
قام فريقنا بتطوير سكربت لتخطي الـ WDEG – ASR مع بعض المميزات الاضافية ايضا وهنا نقوم بعرض السكربت وقيامه بتنفيذ أحد الطلبات:
</DIV>
<p><img src="../../img/WDEG/2.gif" alt=""></p>
<DIV dir="rtl" align="right">
ملاحظة: سوف يتم شرح التكنيك بتفصيل اكثر مع مشاركة الاكواد في احد ال Trainings القادمة باذن الله.
</DIV>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="/posts/cve-2022-21661/">
                  <span class="button__text">Detailed Static/Dynamic Analysis For (CVE-2022-21661)</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Confidential Team</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
